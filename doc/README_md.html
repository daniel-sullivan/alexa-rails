<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Alexa-rails">Alexa-rails</a>
    <li><a href="#label-Intallation-2FUsage">Intallation/Usage</a>
    <li><a href="#label-Migrations">Migrations</a>
    <li><a href="#label-Configuration">Configuration</a>
    <li><a href="#label-Request+handling">Request handling</a>
    <li><a href="#label-Adding+session+variable-3A">Adding session variable:</a>
    <li><a href="#label-Slot+elicitations">Slot elicitations</a>
    <li><a href="#label-Delegate+response">Delegate response</a>
    <li><a href="#label-Views">Views</a>
    <li><a href="#label-Render+custom+template+instead+of+default">Render custom template instead of default</a>
    <li><a href="#label-SSML">SSML</a>
    <li><a href="#label-Re-prompts">Re-prompts</a>
    <li><a href="#label-Cards">Cards</a>
    <li><a href="#label-Type+-26+Title">Type &amp; Title</a>
    <li><a href="#label-Permission+cards">Permission cards</a>
    <li><a href="#label-Handling+Amazon-27s+Built-in+Intents+-2F+Other+request+types">Handling Amazon&#39;s Built-in Intents / Other request types</a>
    <li><a href="#label-Installation">Installation</a>
    <li><a href="#label-Contributing">Contributing</a>
    <li><a href="#label-License">License</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="./Gemfile.html">Gemfile</a>
  
    <li><a href="./Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="./MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li><a href="./README_md.html">README</a>
  
    <li><a href="./Rakefile.html">Rakefile</a>
  
    <li><a href="./alexa_gemspec.html">alexa.gemspec</a>
  
    <li><a href="./app/assets/config/alexa_manifest_js.html">alexa_manifest.js</a>
  
    <li><a href="./app/assets/javascripts/alexa/application_js.html">application.js</a>
  
    <li><a href="./app/assets/stylesheets/alexa/application_css.html">application.css</a>
  
    <li><a href="./lib/tasks/alexa_tasks_rake.html">alexa_tasks.rake</a>
  
    <li><a href="./test/dummy/Rakefile.html">Rakefile</a>
  
    <li><a href="./test/dummy/app/assets/config/manifest_js.html">manifest.js</a>
  
    <li><a href="./test/dummy/app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="./test/dummy/app/assets/javascripts/cable_js.html">cable.js</a>
  
    <li><a href="./test/dummy/app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="./test/dummy/config_ru.html">config.ru</a>
  
    <li><a href="./test/dummy/package_json.html">package.json</a>
  
    <li><a href="./test/dummy/public/404_html.html">404.html</a>
  
    <li><a href="./test/dummy/public/422_html.html">422.html</a>
  
    <li><a href="./test/dummy/public/500_html.html">500.html</a>
  
    <li><a href="./test/dummy/public/apple-touch-icon-precomposed_png.html">apple-touch-icon-precomposed.png</a>
  
    <li><a href="./test/dummy/public/apple-touch-icon_png.html">apple-touch-icon.png</a>
  
    <li><a href="./test/dummy/public/favicon_ico.html">favicon.ico</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.md">

<h1 id="label-Alexa-rails">Alexa-rails<span><a href="#label-Alexa-rails">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><code>alexa-rails</code> is a ruby gem which is a mountable rails engine
that will add abilities to your Ruby on Rails application to handle Amazon
alexa requests and responses.</p>

<h2 id="label-Intallation-2FUsage">Intallation/Usage<span><a href="#label-Intallation-2FUsage">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Do the usual by adding the following to your <code>Gemfile</code>:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;alexa-rails&#39;</span>
</pre>

<h3 id="label-Migrations">Migrations<span><a href="#label-Migrations">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The gem provides migrations that are needed to use few features of the gem.
For example: Saving or reading the user&#39;s skill usage count. To
generate the migrations, run the following</p>

<pre class="ruby">$ <span class="ruby-identifier">rails</span> <span class="ruby-identifier">generate</span> <span class="ruby-identifier">alexa</span><span class="ruby-operator">:</span><span class="ruby-identifier">migrations</span>
$ <span class="ruby-identifier">rake</span> <span class="ruby-identifier">db</span><span class="ruby-operator">:</span><span class="ruby-identifier">migrate</span>
</pre>

<h3 id="label-Configuration">Configuration<span><a href="#label-Configuration">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Set alexa skill IDs in environment config (ex:
config/environments/development.rb).</p>

<pre class="ruby"><span class="ruby-comment"># config/environments/development.rb</span>

  <span class="ruby-comment"># For request validation</span>
  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">x</span>.<span class="ruby-identifier">alexa</span>.<span class="ruby-identifier">skill_ids</span> = [
    <span class="ruby-string">&quot;amzn1.ask.skill.xxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx&quot;</span>
  ]

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">x</span>.<span class="ruby-identifier">alexa</span>.<span class="ruby-identifier">default_card_title</span> = <span class="ruby-string">&quot;Alexa rails&quot;</span>
</pre>

<p>Mount the engine for routes handling in your routes</p>

<pre class="ruby"><span class="ruby-comment"># config/routes.rb</span>

  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">routes</span>.<span class="ruby-identifier">draw</span> <span class="ruby-keyword">do</span>
    <span class="ruby-operator">...</span>
    <span class="ruby-identifier">mount</span> <span class="ruby-constant">Alexa</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>, <span class="ruby-identifier">at</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;/alexa&quot;</span>
  <span class="ruby-keyword">end</span>
</pre>

<p>This will make you Rails app accept <code>POST</code> requests from <a
href="Alexa.html">Alexa</a> at <code>
https://<your-domain>/alexa/intent_handlers </code> This has to be provided
as the HTTPS endpoint URL for the skill.</p>

<h3 id="label-Request+handling">Request handling<span><a href="#label-Request+handling">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To handle an intent, you will have to create an intent handler class. For
example, if your intent is named <code>PlaceOrder</code>, you will have to
create the following file under you
<code>app/lib/alexa/intent_handlers</code> directory.</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">Alexa</span>
  <span class="ruby-keyword">module</span> <span class="ruby-constant">IntentHandlers</span>
    <span class="ruby-keyword">class</span> <span class="ruby-constant">PlaceOrder</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Alexa</span><span class="ruby-operator">::</span><span class="ruby-constant">IntentHandlers</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">handle</span>
        <span class="ruby-operator">...</span>
        <span class="ruby-identifier">response</span> <span class="ruby-comment"># intent handlers should always return the +response+ object</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>All intent handlers should contain a <code>#handle</code> method that has
required logic as to how to handle the intent request. For example, adding
session variables, setting response to elicit slots, delegate etc.</p>

<p><strong>Note</strong>: <code>#handle</code> method should always return the
<code>response</code> object. <code>response</code> object in available in
the scope of <code>#handle</code>.</p>

<p>See [Handling Amazon&#39;s Built-in Intents / Other request types] section
to see how to handle Amazon&#39;s built-in intent and other requests types.</p>

<h4 id="label-Adding+session+variable-3A">Adding session variable:<span><a href="#label-Adding+session+variable-3A">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">session</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">my_var</span><span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>)

<span class="ruby-comment"># Accesssing session variable</span>
<span class="ruby-identifier">session</span>[:<span class="ruby-identifier">my_var</span>]
</pre>

<h4 id="label-Slot+elicitations">Slot elicitations<span><a href="#label-Slot+elicitations">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Depending on your conditions, you can set the reponse to elicit a specific
slot and the respecitve views are used.</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">elicit_slot!</span>(:<span class="ruby-constant">SlotName</span>)
</pre>

<h4 id="label-Delegate+response">Delegate response<span><a href="#label-Delegate+response">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p><code>#handle</code> is expected to return an instance of
<code>Alexa::Response</code> or its subclasses. In normal cases, the
<code>response</code> object is returned. In cases where the slots
elicitation is delegated to alexa, an instance of
<code>Alexa::Responses::Delegate</code> has to be returned.</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">handle</span>
    <span class="ruby-operator">...</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Alexa</span><span class="ruby-operator">::</span><span class="ruby-constant">Responses</span><span class="ruby-operator">::</span><span class="ruby-constant">Delegate</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Views">Views<span><a href="#label-Views">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The content for SSML and display cards is not set in the intent handler
classes. We follow rails convention and expect all response content for
intents to be in their respective <code>default</code> view files.</p>

<p>Also, the views are context locale dependant.</p>

<p>Given an intent named <code>PlaceOrder</code>, you view files would be</p>
<ul><li>
<p>SSML:
<code>views/alexa/en_us/intent_handlers/place_order/default.ssml.erb</code></p>
</li><li>
<p>Card:
<code>views/alexa/en_us/intent_handlers/place_order/default.text.erb</code></p>
</li></ul>

<p>In case of slot elicitations, follow a similar convention but make sure you
name the <code>ssml</code> and <code>text</code> files with the same name
as the slot that is being elicited. For example, in the
<code>PlaceOrder</code> intent, the elicatation for <code>Address</code>
slot would have the following views</p>
<ul><li>
<p>SSML:
<code>views/alexa/en_us/intent_handlers/place_order/elicitations/address.ssml.erb</code></p>
</li><li>
<p>Card:
<code>views/alexa/en_us/intent_handlers/place_order/elicitations/address.text.erb</code></p>
</li></ul>

<h5 id="label-Render+custom+template+instead+of+default">Render custom template instead of default<span><a href="#label-Render+custom+template+instead+of+default">&para;</a> <a href="#top">&uarr;</a></span></h5>

<p>If you wish to force the <code>response</code> object to take contents from
a different template file instead of <code>default.*.erb</code>, pass the
custom filename with <code>Alexa::Response#with(template: )</code>.</p>

<p>For example: Instead of <code>default</code>, if you wish to render the
contents of <code>no_results.ssml.erb</code> and
<code>no_results.text.erb</code>, return the response by forcing the
template with the following:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">handle</span>
    <span class="ruby-operator">...</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">with</span>(<span class="ruby-identifier">template</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">no_results</span>)
  <span class="ruby-keyword">end</span>
</pre>

<p>and make sure you add your contents in the <code>no_results.*.erb</code>
files in your intent handlers&#39; views&#39; directory.</p>

<h4 id="label-SSML">SSML<span><a href="#label-SSML">&para;</a> <a href="#top">&uarr;</a></span></h4>

<h5 id="label-Re-prompts">Re-prompts<span><a href="#label-Re-prompts">&para;</a> <a href="#top">&uarr;</a></span></h5>

<p>By default, there is no re-prompt SSML is added to the response. However,
re-prompt SSML can be set in the ssml view of the intent response or a slot
elicitation view with a <code>content_for :repromt_ssml</code> like this:</p>

<pre>What is your address?

&lt;% content_for :repromt_ssml do %&gt;
  Where would you like the pizza to be delivered?
&lt;% end %&gt;</pre>

<h4 id="label-Cards">Cards<span><a href="#label-Cards">&para;</a> <a href="#top">&uarr;</a></span></h4>

<h5 id="label-Type+-26+Title">Type &amp; Title<span><a href="#label-Type+-26+Title">&para;</a> <a href="#top">&uarr;</a></span></h5>

<p>By default, the card type is set to <code>Simple</code>. To change the card
type and title, use the <code>content_for</code> blocks in the
<code>text</code> view file for the response as follows:</p>

<pre>&lt;% content_for :card_type do %&gt;
  Simple
&lt;% end %&gt;
&lt;% content_for :card_title do %&gt;
  Get your pizza
&lt;% end %&gt;</pre>

<h5 id="label-Permission+cards">Permission cards<span><a href="#label-Permission+cards">&para;</a> <a href="#top">&uarr;</a></span></h5>

<p>To render a permission card. Use <code>ask_for_permissions_consent</code>
as the <code>card_type</code> and provide the scope in
<code>permissions_scope</code> content_for block. Following is an example
for Device address permission card.</p>

<pre>&lt;% content_for :card_type do %&gt;
  ask_for_permissions_consent
&lt;% end %&gt;

&lt;% content_for :permissions_scope do %&gt;
  read::alexa:device:all:address
&lt;% end %&gt;</pre>

<p><em>Note</em>: The permission card should not have any other content other
than the content for <code>card_type</code> and
<code>permissions_scope</code>.</p>

<h2 id="label-Handling+Amazon-27s+Built-in+Intents+-2F+Other+request+types">Handling Amazon&#39;s Built-in Intents / Other request types<span><a href="#label-Handling+Amazon-27s+Built-in+Intents+-2F+Other+request+types">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Requests for Amazon&#39;s built-in intents and other request types are also
handled with intent handlers. Below is the mapping for every request type
and respective intent handler classes. These intent handlers are not
included in the gem as they are a but specific to the application. Refer to
the table below and implement the intent handlers.</p>

<p>Built-in Intents:</p>

<p>| Intent name | Handler class | | ————- | ————- | | AMAZON.CancelIntent |
<code>Alexa::IntentHandlers::GoodBye</code> | | AMAZON.StopIntent |
<code>Alexa::IntentHandlers::GoodBye</code> | | AMAZON.HelpIntent |
<code>Alexa::IntentHandlers::Help</code> |</p>

<p>Other request types:</p>

<p>| Request type | Handler class | | ————- | ————- | | Launch request |
<code>Alexa::IntentHandlers::LaunchApp</code> | | Session end request |
<code>Alexa::IntentHandlers::SessionEnd</code> |</p>

<h2 id="label-Installation">Installation<span><a href="#label-Installation">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;alexa&#39;</span>
</pre>

<p>And then execute: <code>bash $ bundle </code></p>

<p>Or install it yourself as: <code>bash $ gem install alexa </code></p>

<h2 id="label-Contributing">Contributing<span><a href="#label-Contributing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Contribution directions go here.</p>

<h2 id="label-License">License<span><a href="#label-License">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The gem is available as open source under the terms of the <a
href="http://opensource.org/licenses/MIT">MIT License</a>.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

